# Mr.B's Gravitational Laboratory

Hello,welcome to Mr.B's Gravitational Laboratory or you can call it GAVLAB.

## What can you do in GAVLAB

Please don't be confused by its name because GAVLAB is not a real laboratory.
Actually it's a virtual laboratory running on computer, a program which can simulate 
the physical process or a system driven by gravitational force.

You can simulate any gravitational process because GAVLAB allows the users to
design their own system in the universe.
In this manual mode users have to set up all information of the system,including the planet's name,mass,radius,position,velocity and RGB color.
It's an exhausting task!

Besides manual mode there are another two automodes for the users who are too busy to set up the system manually.

The first choice is to simulate the real solar system with eight planets in it.
All data was provided by Professor Xue on the website.

The other choice is a little crazy.
It's random mode.
Random mode can generate any number of planets randomly in random position with random velocity and random mass and even random color.
Everything is random!
It means we can simulate hundreds of planets 
by typing several keys on the keyboard and then enjoy the universe and drink a cup of coffee.
It's convenient!

## How to run GAVLAB

The first step of running GAVLAB is easy:get a computer. More specifi- cally, a computer with UNIX based system such as Mac OS or Linux system. Unfortunately GAVLAB cannot run on Windows system because there
are a lot of libraries missing which I will list out later.

Anyway Macintosh is the best choice. On a Mac computer all you have to do
is double clicking the executable file named GAVLAB with the sun-shaped logo.

![](/TEX/100.png?raw=true "GAVLAB is simulating a system with 100 planets")

## Overview of GAVLAB

GAVLAB was built in C++ language with a little Object-Oriented programing technique. It contains data abstraction,inheritance and dynamic binding.

In GAVLAB each planet is a CPlanet object and the whole solar is a CSolar object which is data abstraction.

There are several kinds of integrators in GAVLAB. Each of them is an object of class derived from CIntegrator class which is inheritance.
Different integrators share the same method Update with different implementation code which is dynamic binding.

Also I used class template when I was building my math library Vector which is generic programing.

The structure of GAVLAB is MVC where I imitated from the software developing.
Control class takes in charge of the whole program and interact with users in command window.
Model is actually math. To make our trajectory stable and correct I used Symplectic Integrator with two order,four order and six order. They can be notated as SI2,SI4 and SI6.
View method makes GAVLAB visual with OpenGL which is an open graphics API.

## MVC

MVC is Model View and Controller.
Model for GAVLAB here is just simulating the gravitational process.
View is to let the users see the result of the program.
And Controller is the commander which takes the command of users and tells the program what to do.

In GAVLAB there will be a loop.
At the beginning of each loop the Controller will get the command of the users such as starting simulation or pause.
Then it parses the command and execute the command.

After that the model will simulate the physics process according the integrator and update the state.

Finally View is responsible for making the animation according the data generated by model.

![](/TEX/frame.png?raw=true "GAVLAB has a frame similar to MVC")

## Quick description of Symplectic Integrator

As we know almost all GAVLAB has to do is simulating. Because the real physics world is driven by differential equation such as Newton’s Law or Hamiltonian equation, GAVLAB has to integrate those equations to get the solution. So we need a good integrator.

There’s something different between computer simulation and real world’s physical process. In computer we can only solve difference equations rather than differential equations because computers can only deal with decrete math. So instead of calculating infinitesimal step time we have to calculate the new state of the system after some pretty small but finite time step τ.Then if τ is too large it will lose accuracy.

There’re some good integrators such as Euler method or Runge-Kutta method. However those methods are not suitable in GAVLAB cause we want our trajectory stable. It’s easy to know that the deviation of energy will increase as time goes through using Euler or Runge-Kutta method which means the radius of planet’s trajectory will decrease slowly and finally move to sun.

So in GAVLAB I used Symplectic Integrating method which is able to maintain the symplectic proporty of the planet’s canonical coordinate and canonical momentum ![](http://latex.codecogs.com/gif.latex?%28q%2C%20p%29).

### SI2

Actually SI2 is just Leap Frog algorithm.

![](http://latex.codecogs.com/gif.latex?%5Cbegin%7Baligned%7D%20q%5E%7B*%7D%20%26%3D%20q%28t_%7Bk-1%7D%29%20&plus;%20%5Cfrac%7B%5Ctau%7D%7B2%7D%5Cleft%28%20%5Cfrac%7B%5Cpartial%20T%7D%7B%5Cpartial%20p%7D%5Cright%29_%7Bp%3Dp%28t_%7Bk-1%7D%29%7D%20%5C%5C%20p%28t_%7Bk%7D%29%20%26%3D%20p%28t_%7Bk-1%7D%29%20-%20%5Cfrac%7B%5Ctau%7D%7B2%7D%5Cleft%28%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20q%7D%5Cright%29_%7Bq%3Dq%5E%7B*%7D%7D%20%5C%5C%20q%28t_%7Bk%7D%29%20%26%3D%20q%28t_%7Bk-1%7D%29%20&plus;%20%5Cfrac%7B%5Ctau%7D%7B2%7D%5Cleft%28%20%5Cfrac%7B%5Cpartial%20T%7D%7B%5Cpartial%20p%7D%5Cright%29_%7Bp%3Dp%28t_%7Bk%7D%29%7D%20%5Cend%7Baligned%7D)

here ![](http://latex.codecogs.com/gif.latex?c_%7B1%7D%3Dc_%7B2%7D%3D%5Cfrac%7B1%7D%7B2%7D%5Cquad%20d_%7B1%7D%3D1%5Cquad%20d_%7B2%7D%3D0)

And here's the how SI2 works.


![](/TEX/SI2.png?raw=true "GAVLAB is simulating solar system with SI2")

As you can see SI2(LeapFrog method) is not pretty stable for trajectory.
The energy of planet will decrease as time goes by and finally fall into sun.
So we have to increase the order of integration to get more precise solution.

### SI4

The formula of SI4 was derived by Neri in 1987 and the difference equation is

![](http://latex.codecogs.com/gif.latex?%5Cbegin%7Baligned%7D%20q%5Ei%20%26%3D%20q%5E%7Bi-1%7D%20&plus;%20%5Ctau%20c_%7Bi%7D%20%5Cfrac%7B%5Cpartial%20T%7D%7B%5Cpartial%20p%7D%5Cleft%28p%5E%7Bi-1%7D%20%5Cright%29%20%5C%5C%20p%5Ei%20%26%3D%20p%5E%7Bi-1%7D%20-%20%5Ctau%20d_%7Bi%7D%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20q%7D%5Cleft%28q%5E%7Bi%7D%20%5Cright%29%20%5Cquad%20i%3D1%2C2%5Cdots%204%20%5Cend%7Baligned%7D)

and the coefficient is

![](http://latex.codecogs.com/gif.latex?%5Cbegin%7Baligned%7D%20c_%7B1%7D%20%26%3D%20c_%7B4%7D%3D%5Cfrac%7B1%7D%7B2%282-%5Csqrt%5B3%5D%7B2%7D%29%7D%2C%5Cquad%20c_%7B2%7D%3Dc_%7B3%7D%3D%5Cfrac%7B1-%5Csqrt%5B3%5D%7B2%7D%7D%7B2%282-%5Csqrt%5B3%5D%7B2%7D%29%7D%5C%5C%20d_%7B1%7D%20%26%3D%20d_%7B3%7D%3D%5Cfrac%7B1%7D%7B2-%5Csqrt%5B3%5D%7B2%7D%7D%2C%5Cquad%20d_%7B2%7D%3Dc_%7B3%7D%3D-%5Cfrac%7B%5Csqrt%5B3%5D%7B2%7D%7D%7B2-%5Csqrt%5B3%5D%7B2%7D%7D%2C%5Cquad%20d_%7B4%7D%3D0%20%5Cend%7Baligned%7D)

![](/TEX/SI4.png?raw=true "GAVLAB is simulating solar system with SI4")

So it's clearly that SI4 can handle the gravitational system simulation.
The trajectory of mercury venus and earth can maintain perfect ellipse after long time.

### SI6

The formula of SI6 was derived by Yoshida in 1990 and the difference equation is

![](http://latex.codecogs.com/gif.latex?%5Cbegin%7Baligned%7D%20q%5Ei%20%26%3D%20q%5E%7Bi-1%7D%20&plus;%20%5Ctau%20c_%7Bi%7D%20%5Cfrac%7B%5Cpartial%20T%7D%7B%5Cpartial%20p%7D%5Cleft%28p%5E%7Bi-1%7D%20%5Cright%29%20%5C%5C%20p%5Ei%20%26%3D%20p%5E%7Bi-1%7D%20-%20%5Ctau%20d_%7Bi%7D%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20q%7D%5Cleft%28q%5E%7Bi%7D%20%5Cright%29%20%5Cquad%20i%3D1%2C2%5Cdots%2010%20%5Cend%7Baligned%7D)

here the coefficient is

![](http://latex.codecogs.com/gif.latex?%5Cbegin%7Baligned%7D%20x_%7B0%7D%26%3D-%5Cfrac%7B%5Csqrt%5B3%5D%7B2%7D%7D%7B2-%5Csqrt%5B3%5D%7B2%7D%7D%2C%5Cquad%20x_%7B1%7D%3D%5Cfrac%7B1%7D%7B2-%5Csqrt%5B3%5D%7B2%7D%7D%5C%5C%20y_%7B0%7D%26%3D-%5Cfrac%7B%5Csqrt%5B5%5D%7B2%7D%7D%7B2-%5Csqrt%5B5%5D%7B2%7D%7D%2C%5Cquad%20y_%7B1%7D%3D%5Cfrac%7B1%7D%7B2-%5Csqrt%5B5%5D%7B2%7D%7D%5C%5C%20d_%7B1%7D%26%3Dd_%7B3%7D%3Dd_%7B7%7D%3Dd_%7B9%7D%3Dx_%7B1%7Dy_%7B1%7D%2C%5Cquad%20d_%7B2%7D%3Dd_%7B9%7D%3Dx_%7B0%7Dy_%7B1%7D%5C%5C%20d_%7B4%7D%26%3Dd_%7B6%7D%3Dx_%7B1%7Dy_%7B0%7D%2C%5Cquad%20d_%7B5%7D%3Dx_%7B0%7Dy_%7B0%7D%5C%5C%20c_%7B1%7D%26%3D%5Cfrac%7B1%7D%7B2%7Dd_%7B1%7D%2C%5Cquad%20c_%7B10%7D%3D%5Cfrac%7B1%7D%7B2%7Dd_%7B9%7D%5C%5C%20c_%7Bi%7D%26%3D%5Cfrac%7B1%7D%7B2%7D%5Cleft%28d_%7Bi-1%7D&plus;d_%7Bi%7D%20%5Cright%29%5Cquad%20i%3D2%2C3%2C%5Cdots%2C9%20%5Cend%7Baligned%7D)

Detail of the algorithm above is provided in my blog ![cskksdfklpz](http://www.cskksdfklpz.com/blog/)
